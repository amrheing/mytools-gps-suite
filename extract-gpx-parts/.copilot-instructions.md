# Extract GPX Parts - Copilot Instructions

## Project Overview
Extract GPX Parts is a Flask web application that extracts and separates different components (waypoints, tracks, routes) from GPX container files into individual files. It provides both CLI and web interface capabilities with comprehensive file management.

## Technical Stack
- **Backend**: Python 3.13 with Flask 2.3.3
- **Frontend**: HTML5, CSS3, JavaScript with responsive design
- **XML Processing**: ElementTree with namespace handling
- **Container**: Python slim with Werkzeug server
- **Storage**: Persistent volumes for uploads and processed files
- **Deployment**: Docker containerized on port 6020

## Architecture Overview
```
extract-gpx-parts/
├── gpx_extractor.py        # Core CLI extraction engine
├── web/                    # Flask web application
│   ├── app.py             # Main Flask application
│   ├── templates/         # Jinja2 HTML templates
│   ├── static/           # CSS, JS, and assets
│   └── requirements.txt  # Python dependencies
├── data/                 # Persistent storage
│   ├── uploads/         # User uploaded files
│   └── processed/       # Extracted components
└── Dockerfile           # Container configuration
```

## Core Components

### 1. GPX Extraction Engine (`gpx_extractor.py`)
- **GPXExtractor Class**: Main extraction logic
- **Namespace Handling**: Proper GPX 1.1 XML namespace support
- **Component Extraction**:
  - `extract_waypoints()` - Point features with coordinates
  - `extract_tracks()` - GPS tracking data with segments
  - `extract_routes()` - Planned navigation routes
- **File Generation**: Individual GPX files for each component type

### 2. Flask Web Application (`web/app.py`)
- **Upload Handling**: Secure file upload with validation
- **Processing Pipeline**: GPX extraction and file organization
- **Download Management**: Individual and batch ZIP downloads
- **File Preview**: Content preview with syntax highlighting
- **Auto-cleanup**: Temporary file removal after 1 hour

### 3. Frontend Interface (`web/templates/`, `web/static/`)
- **Upload Interface**: Drag-drop and file selection
- **Results Display**: Tabular view with file selection
- **Progress Indicators**: Real-time processing feedback
- **File Management**: Preview, download, and selection tools

## Key Features

### File Processing
- **Multi-format Support**: GPX 1.0 and 1.1 compatibility
- **Large File Handling**: Efficient processing of complex GPS data
- **Error Recovery**: Graceful handling of malformed XML
- **Metadata Preservation**: Maintains original file attributes

### Web Interface
- **Responsive Design**: Mobile-friendly interface
- **File Selection**: Multi-select with type filtering
- **Batch Operations**: Download selected files as ZIP
- **Real-time Feedback**: Progress bars and status updates

### Data Management
- **Persistent Storage**: Uploaded and processed files retained
- **Auto-cleanup**: Scheduled removal of old temporary files
- **File Organization**: Structured directory layout
- **Security**: File validation and sanitization

## Development Guidelines

### Code Structure
```python
# Core extraction pattern
class GPXExtractor:
    def __init__(self, gpx_file_path):
        self.tree = ET.parse(gpx_file_path)
        self.root = self.tree.getroot()
        self.namespace = {'gpx': 'http://www.topografix.com/GPX/1/1'}
    
    def extract_waypoints(self, output_dir):
        # Extract and save waypoint data
    
    def extract_tracks(self, output_dir):
        # Extract and save track data
    
    def extract_routes(self, output_dir):
        # Extract and save route data
```

### Flask Application Patterns
- **Route Organization**: Clear separation of upload, processing, download
- **Error Handling**: Comprehensive exception management
- **File Security**: Proper file validation and storage
- **Template Structure**: Modular Jinja2 templates with inheritance

### Frontend JavaScript
- **File Handling**: Modern File API usage
- **AJAX Operations**: Asynchronous file downloads
- **UI Updates**: Dynamic content management
- **Error Feedback**: User-friendly error messages

## API Endpoints

### Core Routes
- `GET /` - Main upload interface
- `POST /upload` - File upload and processing
- `GET /download/<path:directory>/<filename>` - Individual file download
- `POST /download-selected` - Batch download as ZIP
- `GET /preview/<path:directory>/<filename>` - File content preview

### File Management
- Automatic directory creation for uploads/processing
- Unique directory naming to prevent conflicts
- File cleanup scheduling for storage management

## Configuration & Deployment

### Environment Variables
- `FLASK_ENV` - Application environment (production/development)
- `PORT` - Server port (default: 80 for container)
- `UPLOAD_FOLDER` - File upload directory path
- `PROCESSED_FOLDER` - Processed files directory path

### Docker Configuration
- **Base Image**: Python 3.13-slim for optimal size
- **Dependencies**: Flask, Werkzeug via requirements.txt
- **Volumes**: Persistent storage for data directory
- **Port Mapping**: Internal 80 → External 6020

### Persistent Storage
- Upload directory: `./extract-gpx-parts/data/uploads`
- Processed directory: `./extract-gpx-parts/data/processed`
- Automatic directory creation and permission management

## Security Considerations
- File type validation (GPX only)
- File size limits (100MB maximum)
- Secure file naming and storage
- Input sanitization for XML processing
- Temporary file cleanup

## Performance Optimization
- Stream processing for large files
- Efficient XML parsing with ElementTree
- Compressed download archives
- Client-side file selection optimization

## Future Enhancement Areas
- **Advanced Filtering**: Custom component extraction rules
- **Format Conversion**: Output to other GPS formats (KML, TCX)
- **Data Analysis**: GPS statistics and visualization
- **Cloud Integration**: Direct cloud storage support
- **API Expansion**: RESTful API for programmatic access
- **Real-time Processing**: WebSocket progress updates